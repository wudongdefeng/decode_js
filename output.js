//Fri Sep 20 2024 04:52:52 GMT+0000 (Coordinated Universal Time)
//Base:https://github.com/echo094/decode-js
//Modify:https://github.com/smallfawn/decode_action
if (mode) {
  activityUrl = "https://cjhy-isv.isvjcloud.com/wxCollectionActivity/activity?activityId=8d0f86f522d34fd6828e3c75fe4091f0";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2/0d5b8e8cb94a46bbbe4aff25dc1e9c0d?activityId=0d5b8e8cb94a46bbbe4aff25dc1e9c0d";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=7f4116e9-34b2-4f6d-9684-d7ca7c4b3d69&activityId=1711295984027947010&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interaction/v1/index?activityType=10024&templateId=20210518190900jgyl01&activityId=1714916689487958018&nodeId=101001&prd=crm";
  activityUrl = "https://jingyun-rc.isvjcloud.com/h5/pages/plusGift/plusGift5?id=8e2fcea1fb4f64a11795ffbae977ba58&userId=1000350703";
  activityUrl = "https://hdb-isv.isvjcloud.com/h5/pages/plusGift/plusGift1?id=dffb05f66b3f1361ddec86a315c052e4&userId=1000461510";
  activityUrl = "https://gzsl-isv.isvjcloud.com/wuxian/mobileForApp/dist/views/pages/extraGift.html?activityType=JG_1&activityId=644508";
  activityUrl = "https://jinggeng-isv.isvjcloud.com/ql/front/showCart?id=9e8080b38b49247b018b4ab08b970281&user_id=1000453449";
  activityUrl = "https://jinggeng-isv.isvjcloud.com/ql/front/showCart?id=9e8080348b68fabe018b7e9eb6a306d9&user_id=1000361845";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2?activityId=00175a1d132542c1a8d6321501cf3d3d";
  activityUrl = "https://hdb-isv.isvjcloud.com/h5/pages/plusGift/plusGift3?id=755f118f0066f6ffe910fc7c849e3ff5&userId=1000111946";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2/d4f29769aea4402fbe787652f7210d1a?activityId=d4f29769aea4402fbe787652f7210d1a";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2/6bfcc3e5963e42f4a5a49a434668dd83?activityId=6bfcc3e5963e42f4a5a49a434668dd83";
  activityUrl = "https://cjhy-isv.isvjcloud.com/wxCollectionActivity/activity?activityId=a13e2f5048f644e8abbfbc990f8034fb";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2/0a65517110924fb893dbcd469bc44ad2?activityId=0a65517110924fb893dbcd469bc44ad2";
  activityUrl = "https://lzkj-isv.isvjd.com/wxCollectionActivity/activity2/fdc4d1c08a594a8d8769072c0452bf7e?activityId=fdc4d1c08a594a8d8769072c0452bf7e";
  activityUrl = "https://cjhy-isv.isvjcloud.com/wxCollectionActivity/activity?activityId=891b965fba8a4c599a04ea6b00dbff1c";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=20210518190900jgyl011&activityId=1740268731560538114&nodeId=101001&prd=cjwx";
  activityUrl = "https://cjhy-isv.isvjcloud.com/wxCollectionActivity/activity?activityId=8e61f7b04b184767836879c5d0030ddf";
  activityUrl = "https://jingyun-rc.isvjcloud.com/h5/pages/plusGift/plusGift3?id=33682adb5b18b15f6e18474b4fd796da&userId=10531658";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1747454459906019329&templateId=20210518190900jgyl011&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1752631787825057794&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&nodeId=101001&prd=cjwx&adsource=tg_storePage";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1778229184387391489&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&activityId=1785242486584487938&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1787778647572803586&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&activityId=1788121408374505474";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&activityId=1788759065054867457&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1791354708587520002&templateId=20210518190900jgyl011&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2e&activityId=1790569739104591873&nodeId=101001&prd=cjwx";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&activityId=1796843423961112577&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2f&nodeId=101001&prd=cjwx";
  activityUrl = "https://txzj-isv.isvjcloud.com/cart_item/home?a=TDhQZjBCekt4dldUZnJ4dDBn";
  activityUrl = "https://txzj-isv.isvjcloud.com/cart_item/home?a=THBhTDJVN0ttNmVUZnI5dDBn";
  activityUrl = "https://jingyun-rc.isvjcloud.com/h5/pages/plusGift/plusGift1?id=571eedd13a3ad77e376c3d43e1c2a29d&userId=113135&actForm=single";
  activityUrl = "https://lzkj-isv.isvjcloud.com/prod/cc/interactsaas/index?activityType=10024&templateId=c2af9114-85d5-4c31-ab61-201f370f0f2f&activityId=1798618889292062722&prd=cjwx";
}
const {
  RunMode: lllillil,
  UserMode: lliiii1I,
  baseCommonEnv: lI1lIIi,
  baseCommonEnvKey: lII1l1i1
} = require("./bear");
lI1lIIi.openCardBeanNum = parseInt(process.env.B_WX_ADD_CART_BEAN_NUM || "2");
lII1l1i1.B_WX_ADD_CART_BEAN_NUM = "openCardBeanNum";
lllillil.envInfo = {
  "name": "加购有礼beta",
  "runName": "jd_wx_addCart",
  "version": "2.1.0"
};
class i1iiIil extends lliiii1I {
  constructor(llil1li1, iI1I11I1) {
    super(llil1li1, iI1I11I1);
    this.errCount = 0;
  }
  async ["lzkjToDo"](l1I1Il1I, i1l1iI1i = "", lliII11i = 0) {
    let iilIIII1 = await this.lzkjApi("api/task/" + this.type + "/toDo", {
      "taskId": l1I1Il1I,
      "skuId": i1l1iI1i
    });
    this.debug(iilIIII1);
    if (iilIIII1 && iilIIII1.resp_code === 0) {
      let i1lIllii = iilIIII1.data?.["canSend"];
      switch (i1lIllii) {
        case undefined:
          break;
        case 4:
          return this.putMsg("今日奖品已发完"), this.stop();
        case 5:
        case 6:
          return this.putMsg("活动奖品已发完"), this.stop();
        case 7:
          return this.putMsg("空气"), await this.writeLongCache(), this.exit();
        case 8:
        case 9:
          lliII11i++, this.log("活动人气爆棚", "retry:" + lliII11i);
          if (lliII11i > 10) return this.putMsg("活动人气爆棚"), this.exit();
          return await this.lzkjToDo(l1I1Il1I, i1l1iI1i, lliII11i);
        default:
          this.putMsg("canSend:" + i1lIllii);
          break;
      }
      if (iilIIII1.data) return this.putMsg(iilIIII1.data?.["prizeName"]), await this.writeLongCache(), this.exit();
      return;
    }
    let iIii1ii = iilIIII1?.["resp_msg"];
    if (iIii1ii?.["includes"]("ibatis.exceptions")) return this.putMsg("数据错误"), await this.writeLongCache(), this.exit();
    this.putMsg(iIii1ii);
    if (iIii1ii?.["includes"]("会员等级不足")) return this.exit();
    await this.wxStopSync(iIii1ii);
    this.errCount++;
    if (this.errCount > 3) return this.exit();
  }
  async ["userTask"]() {
    await this.hitCache();
    await this.isvObfuscator();
    if (this.mode === "txzj") {
      if (!this.activityId) return this.putMsg("活动链接错误"), this.stop();
      let lII1II11 = await this.taskPost("front/jd_store_user_info", {
        "token": this.isvToken
      });
      if (!lII1II11 || lII1II11.code !== "success") {
        let iii1I1Ii = lII1II11.msg || "获取用户信息失败";
        return this.putMsg(iii1I1Ii), this.wxStop(iii1I1Ii);
      }
      let iiI1ilI1 = await this.taskGet(this.activityUrl),
        lIIl1Ii = this.textToHtml(iiI1ilI1),
        ii11llii = lIIl1Ii(".error-text").text();
      this.debug(ii11llii);
      if (ii11llii?.["includes"]("已结束")) return this.putMsg("活动已结束"), await this.writeLongCacheByStop(), this.stop();
      let iII1Ii1i = await this.taskPost("cart_item/receive_prize", {
        "pid": this.activityId
      });
      this.debug(iII1Ii1i);
      if (iII1Ii1i && iII1Ii1i.code === "success") {
        this.putMsg("领取成功");
        await this.writeLongCache();
        return;
      }
      let lIllil1I = iII1Ii1i?.["msg"] || "领取失败";
      this.putMsg(lIllil1I);
      await this.wxStopSync(lIllil1I);
      return;
    }
    if (this.mode === "gzsl") {
      let iiIIiIli = await this.gzslApi("getGoodsGiftActivity", {
        "venderId": this.activityId
      });
      this.debug(iiIIiIli);
      if (iiIIiIli && iiIIiIli.status === "1") {
        let I11iIIIi = iiIIiIli.activity?.["startTime"],
          IiilIl1 = iiIIiIli.activity?.["endTime"];
        this.shopId = iiIIiIli.activity?.["shopId"];
        this.venderId = iiIIiIli.activity?.["venderId"];
        this.shopName = iiIIiIli.activity?.["detail"];
        lliiii1I.activity.shopId = this.shopId;
        lliiii1I.activity.venderId = this.venderId;
        lliiii1I.activity.shopName = this.shopName;
        lliiii1I.activity.startTime = I11iIIIi;
        lliiii1I.activity.endTime = IiilIl1;
        if (I11iIIIi && I11iIIIi > this.timestamp()) {
          this.putMsg("活动未开始");
          this.stop();
          return;
        }
        if (IiilIl1 && IiilIl1 < this.timestamp()) {
          this.putMsg("活动已结束");
          this.writeLongCacheByStop();
          this.stop();
          return;
        }
        let lIll1I1 = await this.gzslApi("getGoodsGiftPrizeAndWare", {}, true);
        this.debug(lIll1I1);
        if (lIll1I1 && lIll1I1.status === "1") {
          this.putMsg(lIll1I1.data || "空气");
          await this.writeLongCache();
          return;
        }
        let i11l1ii = lIll1I1?.["msg"] || "领取失败";
        this.putMsg(i11l1ii);
        await this.wxStopSync(i11l1ii);
        return;
      }
      return;
    }
    if (this.mode === "jinggeng") {
      await this.setMixNick();
      let lll1lil = await this.jinggengShopInfo(),
        iIIiilI1 = parseInt(lll1lil(".lastnum").text()),
        lI1lilI = parseInt(lll1lil("#addnum").text());
      if (isNaN(iIIiilI1) || isNaN(lI1lilI)) {
        let l11iIl1I = lll1lil("#description").text();
        this.debug("重匹规则", l11iIl1I);
        const lilI11ll = l11iIl1I.match(/加购(\d+)个宝贝/);
        if (!lilI11ll) {
          this.putMsg("未匹配到加购数量");
          return;
        }
        iIIiilI1 = parseInt(lilI11ll[1]);
        lI1lilI = lll1lil(".btnState2").length;
      }
      this.debug("needCollectionSize:" + iIIiilI1, "hasCollectionSize:" + lI1lilI);
      if (lI1lilI >= iIIiilI1) {
        this.putMsg("已领取过");
        await this.writeLongCache();
        return;
      }
      const i1IlIliI = lll1lil(".btnState1").map((lIIlIl1, IIi11lll) => lll1lil(IIi11lll).attr("id") || lll1lil(IIi11lll).attr("onclick")?.["match"](/\(([^)]+)\)/)?.[1]).get();
      this.debug(i1IlIliI);
      while (lI1lilI < iIIiilI1 && i1IlIliI.length > 0) {
        await this.sleep(2000);
        let ii1II1li = await this.jinggengApi("postAddCart", {
          "itemId": i1IlIliI.shift()
        });
        this.debug(ii1II1li);
        if (ii1II1li && ii1II1li.succ) {
          lI1lilI++;
          let iil1lil = ii1II1li.msg,
            il1i1111 = this.parseJSON(iil1lil);
          if (il1i1111) {
            if (il1i1111?.["actLogDto"]?.["remark"]) {
              this.putMsg(il1i1111?.["actLogDto"]?.["remark"]);
              await this.writeLongCache();
              return;
            }
          }
        } else {
          this.putMsg(ii1II1li?.["msg"] || "加购失败");
          return;
        }
      }
      return;
    }
    if (this.mode == "hdb") {
      await this.login();
      await this.reportPVUV();
      await this.loadFrontAct();
      await this.loadFrontAward();
      let IliilI11 = await this.hdbApi("loadAddCartSetting");
      !(IliilI11 && IliilI11.succ) && this.putMsg(IliilI11?.["message"]);
      if (IliilI11?.["result"]?.["hasReceiveAward"]) {
        this.putMsg("已领取");
        await this.writeLongCache();
        return;
      }
      let I1llliIl = IliilI11.result?.["addCartSetting"]?.["itemAmount"] ?? 5;
      if (this.openCard === 0 && this.prizeList && this.prizeList.filter(ili11I => ["JD_MARKET"].includes(ili11I.awardType)).length > 0) {
        await this.bindWithVender();
        if (this.canNotOpenCard) return this.reseCookieStatus();
      }
      let Il1ll = await this.hdbApi("loadFrontItems");
      if (!(Il1ll && Il1ll.succ)) {
        this.putMsg(Il1ll?.["message"]);
        return;
      }
      let li1iIilI = Il1ll?.["result"] ?? [],
        Il11l1i1 = li1iIilI.filter(Iil111i1 => Iil111i1.isFinish == 1).length,
        lIII11lI = li1iIilI.filter(iiiI1Iil => iiiI1Iil.isFinish == 0);
      while (Il11l1i1 < I1llliIl && lIII11lI.length > 0) {
        let IIi1liII = lIII11lI.shift().skuId;
        this.debug("加购skuId:" + IIi1liII);
        let li1lI1II = 4;
        while (li1lI1II-- > 0) {
          let lI1I1Ii = await this.hdbApi("reportActionLog", {
            "skuId": IIi1liII,
            "actionType": "addCart"
          });
          if (lI1I1Ii && lI1I1Ii.succ) {
            Il11l1i1++;
            await this.sleep(1000);
            break;
          }
          let l11i1lil = lI1I1Ii?.["message"];
          if (l11i1lil?.["includes"]("关注店铺") && (await this.follow())) {
            await this.sleep(1000);
            continue;
          }
          if (l11i1lil?.["includes"]("会员") && retry) {
            await this.bindWithVender();
            if (this.canNotOpenCard) return this.reseCookieStatus();
            await this.sleep(1000);
            continue;
          }
          await this.wxStopSync(l11i1lil);
          this.putMsg(l11i1lil);
          return;
        }
      }
      if (Il11l1i1 < I1llliIl) {
        this.log("加购数量不足,不领取");
        return;
      }
      this.debug("加购完成 " + Il11l1i1 + " - " + I1llliIl);
      let ill1i1l1 = 2;
      while (ill1i1l1-- > 0) {
        let lI111llI = await this.hdbApi("postAddCartFrontAct");
        this.debug(lI111llI);
        if (lI111llI && lI111llI.succ) {
          if (lI111llI.result.succ) {
            this.putMsg(lI111llI.result?.["dmActivityLog"]?.["awardName"] || "空气");
            await this.writeLongCache();
            return;
          } else this.putMsg(lI111llI.result?.["errorMsg"] || lI111llI.result?.["message"]);
        }
        let lI1lill = lI111llI?.["message"];
        if (lI1lill?.["includes"]("关注店铺") && (await this.follow())) {
          await this.sleep(1000);
          continue;
        }
        this.putMsg(lI1lill);
        await this.wxStopSync(lI1lill);
        return;
      }
      return;
    }
    await this.getDefenseUrls();
    if (["10024"].includes(this.activityType)) {
      this.retryStatusRegex = /555/;
      await this.login();
      let Iii1liII = await this.lzkjApi("api/prize/drawPrize");
      if (Iii1liII && Iii1liII.resp_code === 0) {
        if (Iii1liII.data?.["drawNumber"] > 0) {
          this.putMsg("已领取");
          await this.writeLongCache();
          return;
        }
        let III1Iiil = Iii1liII.data?.["prizeInfo"] || [];
        III1Iiil = III1Iiil.filter(lii11iIl => lii11iIl.prizeType == 1);
        this.openCard = III1Iiil.some(i11Iill => i11Iill.beanNum >= lI1lIIi.openCardBeanNum);
      }
      let il1iii1l = await this.lzkjApi("api/task/" + this.type + "/activity");
      if (il1iii1l && il1iii1l.resp_code === 0) {
        let iIiiIlil = il1iii1l.data?.["addWares"] || {},
          lIIil1lI = iIiiIlil?.["skuInfoVO"] || [],
          iillII11 = iIiiIlil?.["completeCount"] || 0,
          lIi1li1l = iIiiIlil?.["finishNum"] || 0,
          lIl11IlI = iIiiIlil?.["oneClickPurchase"] || 0,
          ll11iI1l = iIiiIlil?.["taskId"],
          lli1l11 = il1iii1l.data?.["prizeResultNum"] || 10;
        lIIil1lI = lIIil1lI.filter(I1I1iiI1 => I1I1iiI1.status === 0);
        if (lli1l11 <= 0) {
          this.putMsg("已领完");
          this.stop();
          return;
        }
        if (lIi1li1l - iillII11 > lIIil1lI.length) {
          this.putMsg("加购商品数量错误");
          this.stop();
          return;
        }
        if (["1005", "1006", "1002"].includes(this.joinCode)) {
          if (!this.openCard) return this.putMsg(this.joinDes);
          await this.getShopOpenCardInfo();
          await this.bindWithVender();
          if (this.canNotOpenCard) return this.putMsg(this.joinDes);
          await this.login(false);
        }
        if (lIl11IlI === 0) return this.debug("一键加购"), await this.lzkjToDo(ll11iI1l);
        for (let iIIllI1 = 0; iIIllI1 < lIIil1lI.length; iIIllI1++) {
          this.debug("加购skuId:" + lIIil1lI[iIIllI1].skuId);
          await this.lzkjToDo(ll11iI1l, lIIil1lI[iIIllI1].skuId);
        }
      } else {
        this.putMsg(il1iii1l?.["resp_msg"] || "获取任务错误");
        await this.wxStopSync(il1iii1l?.["resp_msg"]);
      }
      return;
    }
    await this.wxCommonInfo();
    await this.getSimpleActInfoVo();
    this.index === 0 && (await this.getShopInfo());
    this.defenseUrls.length === 0 ? await this.getMyPing() : await this.initPinToken();
    await this.accessLog();
    let li1llIiI = await this.activityContent();
    if (!li1llIiI?.["result"] || !li1llIiI?.["data"]) {
      this.putMsg(li1llIiI?.["errorMessage"]);
      return;
    }
    let IlllII11 = li1llIiI.data?.["cpvos"] ?? [],
      I1I1i111 = li1llIiI.data?.["drawInfo"] ?? {},
      I1lli1I = li1llIiI.data?.["drawInfo"]?.["drawInfo"]?.["beanNum"],
      lil1IliI = li1llIiI.data?.["needCollectionSize"],
      lIi1i11 = li1llIiI.data?.["hasCollectionSize"] ?? 0,
      i11ili = li1llIiI.data?.["oneKeyAddCart"] ?? 0,
      I1li111i = IlllII11.filter(lII1lil => !lII1lil.collection);
    if (![6, 7, 9, 13, 14, 15, 16].includes(I1I1i111.drawInfoType)) {
      this.putMsg("垃圾或领完");
      this.writeLongCacheByStop();
      this.stop();
      return;
    }
    if (lil1IliI - lIi1i11 > I1li111i.length) {
      if (this.domain.includes("cjhy")) {
        this.putMsg("加购商品数量错误");
        this.stop();
        return;
      }
      for (let iIII11ii = 0; iIII11ii < lil1IliI - lIi1i11 - I1li111i.length; iIII11ii++) {
        let lilII1il = this.random(1000000, 9999999);
        I1li111i.push({
          "productId": lilII1il,
          "skuId": lilII1il
        });
      }
    }
    let i1Ili1 = this.activityType === 6 ? "addCart" : "collection",
      iIlI1111 = this.domain.includes("cjhy") ? false : true;
    if (i11ili === 1) {
      let IilI1I1l = 5;
      while (IilI1I1l-- > 0) {
        let iIi11ii = await this.wxApi("wxCollectionActivity/oneKeyAddCart", {
          "activityId": this.activityId,
          "pin": this.secretPin,
          "productIds": JSON.stringify(I1li111i.map(lIii1lli => lIii1lli.skuId))
        });
        this.debug(iIi11ii);
        if (iIi11ii && iIi11ii.result) {
          lIi1i11 = lil1IliI;
          break;
        }
        let Iil1lIil = iIi11ii?.["errorMessage"];
        if (!Iil1lIil) break;
        if (Iil1lIil.includes("购物车已经满了")) continue;
        if (Iil1lIil.includes("会员") && I1lli1I && I1lli1I >= lI1lIIi.openCardBeanNum) {
          await this.getShopOpenCardInfo();
          let IIl1liIi = await this.bindWithVender();
          if (IIl1liIi && IIl1liIi.success && ["0", "9003"].includes(IIl1liIi.busiCode)) continue;
        }
        this.putMsg(Iil1lIil);
        await this.wxStopSync(Iil1lIil);
        return;
      }
    } else {
      I1li111i.length === 0 && iIlI1111 && I1li111i.push(IlllII11[0]);
      while ((iIlI1111 || lIi1i11 < lil1IliI) && I1li111i.length > 0) {
        iIlI1111 = false;
        let IlII1I1i = I1li111i.shift().productId;
        this.debug("加购productId:" + IlII1I1i);
        let II1ll1li = 5;
        while (II1ll1li-- > 0) {
          let lIIil1ll = await this.wxApi("wxCollectionActivity/" + i1Ili1, {
            "activityId": this.activityId,
            "pin": this.secretPin,
            "productId": IlII1I1i
          });
          this.debug(lIIil1ll);
          if (lIIil1ll && lIIil1ll.result) {
            lIi1i11 = lIIil1ll.data?.["hasAddCartSize"] ?? lIi1i11 + 1;
            break;
          }
          let iII1il1l = lIIil1ll?.["errorMessage"];
          if (!iII1il1l) break;
          if (iII1il1l.includes("购物车已经满了")) continue;
          if (iII1il1l.includes("会员") && I1lli1I && I1lli1I >= lI1lIIi.openCardBeanNum) {
            await this.getShopOpenCardInfo();
            let ilIIilil = await this.bindWithVender();
            if (ilIIilil && ilIIilil.success && ["0", "9003"].includes(ilIIilil.busiCode)) continue;
          }
          this.putMsg(iII1il1l);
          await this.wxStopSync(iII1il1l);
          return;
        }
      }
    }
    if (lIi1i11 < lil1IliI) {
      this.log("加购数量不足,不领取");
      return;
    }
    this.debug("加购完成 " + lIi1i11 + " - " + lil1IliI);
    let lii1ii11 = await this.wxApi("wxCollectionActivity/getPrize", {
      "activityId": this.activityId,
      "pin": this.secretPin
    });
    this.debug(lii1ii11);
    if (lii1ii11 && lii1ii11.result && lii1ii11.data?.["drawOk"]) {
      this.putMsg(lii1ii11.data.name);
      await this.writeLongCache();
      return;
    }
    let iiiiiili = lii1ii11?.["errorMessage"] || lii1ii11?.["data"]?.["errorMessage"];
    if (!iiiiiili) return;
    iiiiiili.includes("已领过") && (await this.writeLongCache());
    this.putMsg(iiiiiili);
    await this.wxStopSync(iiiiiili);
    if (iiiiiili.includes("日奖品全部被领取")) {}
  }
}
lllillil.activity = {
  "activityUrl": activityUrl
};
lllillil.TaskClass = i1iiIil;
lllillil.run({
  "whitelist": ["1-20"],
  "main_thread": 3
});